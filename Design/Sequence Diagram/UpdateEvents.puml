@startuml Update Events
title Sequence Diagram â€“ Update Event by ID (PUT /bookngo/events/:id)

actor User
participant Frontend
participant "Express Controller\n(updateEvent)" as Controller
participant "EventService" as Service
participant "EventRepository" as Repo
database "PostgreSQL" as DB

== Request Start ==
User -> Frontend: Edits event details in form
Frontend -> Controller: PUT /bookngo/events/:id\nBody: { title, location, event_date, ... }

note right of Controller
Path Param:
  req.params.id = "64fa8a9c58c"
Body:
  {
    "title": "Music Night Updated",
    "location": "Bangalore",
    "event_date": "2025-09-20",
    "time": "19:00",
    "description": "Updated details",
    "category": "Concert",
    "image_url": "http://image.com/img.jpg"
  }
end note

== Validation ==
Controller -> Controller: Validate ID format & request body
alt Invalid ID or Body
  Controller --> Frontend: HTTP 400 Bad Request
  note right
    {
      "error": "Invalid event ID or missing/invalid fields"
    }
  end note
  return
end alt

== Service & Repo Layer ==
Controller -> Service: updateEventById(id, body)
Service -> Repo: updateEventByIdInDB(id, body)
Repo -> DB: UPDATE events SET ... WHERE id = $1 RETURNING *
DB --> Repo: Updated Event Entity / null

alt Event Found & Updated
  Repo --> Service: EventEntity object
  Service -> Service: Map Entity to EventDTO
  Service --> Controller: EventDTO
  Controller --> Frontend: HTTP 200 OK
  note right
    {
      "message": "Event updated successfully",
      "event": { ...updated fields... }
    }
  end note

else Event Not Found
  Repo --> Service: null
  Service --> Controller: null
  Controller --> Frontend: HTTP 404 Not Found
  note right
    {
      "error": "Event not found"
    }
  end note
end alt

== Server/DB Error ==
group Failure Case
  alt DB failure or exception
    DB -> Repo: throws Error
    Repo --> Service: throws Error
    Service --> Controller: throws Error
    Controller --> Frontend: HTTP 500 Internal Server Error
    note right
      {
        "error": "Something went wrong"
      }
    end note
  end alt
end group

@enduml
